{% extends 'base.html.twig' %}

{% block title %}Bienvenue sur mon Portfolio!{% endblock %}

{% block body %}

    <!-- Section: About Card -->
    <div class="container">
        <div id="about" class="row about-section justify-content-center">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header text-center">
                        <h2 class="font-weight-light">Qui suis-je ?</h2>
                        <h3 class="text-tertiary-color mb-3">{{ about.jobTitle }}</h3>
                    </div>
                    <div class="card-body">
                        <p>{{ about.aboutMe|raw }}</p>
                        <!-- bouton doit lancer le téléchargement du CV -->
                        <div class="mt-3 text-center">
                            <a id="btn_download_cv" class="btn btn-info" href="images/cv_richardbonnegent.pdf" download="CV-Richard-Bonnegent.pdf" aria-label="Télécharger mon CV">Télécharger mon CV</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Section: Statistiques -->
    <section class="section bg-secondary-color text-center">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-6 col-lg-3">
                    <div class="row">
                        <div class="col-5 text-right border-right py-3">
                            <div class="m-auto"><i class="bi bi-clock icon-xl" style="font-size: 45px;" aria-hidden="true"></i></div>
                        </div>
                        <div class="col-7 text-left py-3">
                            <h2 class="text-danger font-weight-bold font40">{{ totalHoursWorked|format_number }}</h2>
                            <p class="mb-1">Heures travaillées</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="row">
                        <div class="col-5 text-right border-right py-3">
                            <div class="m-auto"><i class="bi bi-layers icon-xl" style="font-size: 45px;" aria-hidden="true"></i></div>
                        </div>
                        <div class="col-7 text-left py-3">
                            <h2 class="text-danger font-weight-bold font40">{{ totalProjects|format_number }}</h2>
                            <p class="mb-1">Projets terminés</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="row">
                        <div class="col-5 text-right border-right py-3">
                            <div class="m-auto"><i class="bi bi-emoji-smile icon-xl" style="font-size: 45px;" aria-hidden="true"></i></div>
                        </div>
                        <div class="col-7 text-left py-3">
                            <h2 class="text-danger font-weight-bold font40">{{ totalLikes|format_number }}</h2>
                            <p class="mb-1">Nombre de likes</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="row">
                        <div class="col-5 text-right border-right py-3">
                            <div class="m-auto"><i class="bi bi-cup-hot icon-xl" style="font-size: 45px;" aria-hidden="true"></i></div>
                        </div>
                        <div class="col-7 text-left py-3">
                            <h2 class="text-danger font-weight-bold font40">{{ totalCoffees|format_number }}</h2>
                            <p class="mb-1">Cafés bus</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section: Compétences -->
    <div class="container mt-4">
        <div id="skills" class="row about-section justify-content-center">
            
            <!-- Section: Skills Card -->
            <div class="col-lg-3 col-md-6">
                <div class="card mb-4">
                    <div class="card-header text-center">
                        <h4 class="mt-2">Compétences</h4>
                        <span class="line"></span>  
                    </div>
                    <div class="card-body pb-2">
                        {% for skill, data in skills %}
                            <h5 class="fs-6">{{ skill }} ({{ data.level }})</h5>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ data.percentage }}%" aria-valuenow="{{ data.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Section: Frameworks Card -->
            <div class="col-lg-3 col-md-6">
                <div class="card mb-4">
                    <div class="card-header text-center">
                        <h4 class="mt-2">Frameworks</h4>
                        <span class="line"></span>  
                    </div>
                    <div class="card-body pb-2">
                        {% for framework, data in frameworksMastery %}
                            <h5 class="fs-6">{{ framework }} ({{ data.level }})</h5>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ data.percentage }}%" aria-valuenow="{{ data.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Section: APIs Card -->
            <div class="col-lg-3 col-md-6">
                <div class="card mb-4">
                    <div class="card-header text-center">
                        <h4 class="mt-2">APIS</h4>
                        <span class="line"></span>  
                    </div>
                    <div class="card-body pb-2">
                        {% for api, data in apis %}
                            <h5 class="fs-6">{{ api }} ({{ data.level }})</h5>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ data.percentage }}%" aria-valuenow="{{ data.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Section: Languages Card -->
            <div class="col-lg-3 col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <div class="pull-left">
                            <h4 class="mt-2">Langues</h4>
                            <span class="line"></span>  
                        </div>
                    </div>
                    <div class="card-body pb-2">
                        {% for language, level in about.languages %}
                            <h5 class="fs-6">{{ language }}</h5>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ level }}%" aria-valuenow="{{ level }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Section: Services -->
    <section class="section" id="service">
        <div class="container">
            <h2 class="text-danger m-4">Mes Services</h2>
            <div class="row">
                {% for service in services %}
                    <div class="col-md-4 col-sm-6">
                        <div class="card mb-4">
                            <div class="card-header m-2 has-icon">
                                <h3 class="mt-2 card-title"><i class="{{ service.icon }} text-danger" aria-hidden="true"></i> {{ service.title }}</h3>
                            </div>
                            <div class="card-body pb-2">
                                <p class="subtitle">{{ service.description|raw }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Section: Prix -->
    {# <section class="section" id="price">
        <div class="container">
            <h2 class="text-danger m-4">Packs Tarifs</h2>
            <div class="row align-items-center">
                {% for plan in pricingPlans %}
                    <div class="col-md-6 col-lg-3">
                        <div class="card mb-4 text-center">
                            <div class="card-header m-2">
                                <h3 class="card-title mt-2">{{ plan.name }} <span class="text-danger">{{ plan.price|price }}</span></h3>
                                <div class="card-text">
                                    <span class="text-danger">{{ plan.price|price }}</span> / 
                                    <span>{{ plan.currency }}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="list-item"><span class="text-tertiary-color">{{ plan.projects }}</span> Projets</li>
                                    <li class="list-item"><span class="text-tertiary-color">{{ plan.storage }}</span> Stockage</li>
                                    <li class="list-item"><span class="text-tertiary-color">{{ plan.domains }}</span> Domaines</li>
                                    <li class="list-item"><span class="text-tertiary-color">{{ plan.users }}</span> Utilisateurs</li>
                                </ul>
                            </div>
                            <button class="btn btn-info btn-rounded w-50 mx-auto mb-2">S'abonner</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section> #}

    <!-- Section: Freelance -->
    <section class="section bg-secondary-color py-5">
        <div class="container text-center">
            <h2 class="mb-5 font-weight-normal">Je suis disponible pour des missions freelance</h2>
            <a href="mailto:{{ about.email }}" target="_blank" class="btn btn-info w-lg" aria-label="Envoyer un email à {{ about.email }}">Engagez-moi</a>
        </div>
    </section>

    <!-- Section: Portfolio -->
    <section class="section-portfolio" id="portfolio">
        <div class="container">
            <h2 class="text-danger m-4">Mes Projets</h2>
            <div class="portfolio">
                <!-- Filters -->
                <div class="filters text-center mb-4">
                    <a href="#" data-filter="*" class="btn btn-info active mb-2" aria-label="Afficher tous les projets">Tous</a>
                    <a href="#" data-filter=".new" class="btn btn-info mb-2" aria-label="Afficher les nouveautés">Nouveautés</a>
                    {% for framework in frameworks %}
                        <a href="#" data-filter=".{{ framework|lower }}" class="btn btn-info mb-2" aria-label="Afficher {{ framework }}">{{ framework }}</a>
                    {% endfor %}
                </div>

                <!-- Portfolio Items -->
                <div class="portfolio-container bg-secondary-color border border-primary-color rounded row m-1">
                    {% for project in projects %}
                        <div class="col-md-4 portfolio-item-wrapper {{ project.frameworks|keys|join(' ')|lower }} {% if loop.index <= 5 %}new{% endif %} position-relative">
                            <a href="{{ path('app_project_show', { id: project.id }) }}" class="d-block position-relative">
                                <img src="{{ asset('uploads/projects/' ~ project.image) }}" class="img-fluid my-2" alt="{{ project.title }}">
                                <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                    <h3 class="title text-primary-color text-center">{{ project.title }}</h3>
                                </div>
                            </a>
                        </div>
                    {% endfor %}

                    <!-- Section: Pagination -->
                    <div class="pagination-container text-center mt-4">
                        <nav>
                            <ul class="pagination justify-content-center">
                                <!-- Les boutons de pagination seront générés dynamiquement -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section: Blog -->
    {% include "blog-post/blog-post.html.twig" %}

    <!-- Section: Contact -->
    {% include "home/contact.html.twig" %}

{% endblock %}

{% block javascripts %}
{# Assurez-vous que jQuery est chargé avant d'utiliser le symbole $ #}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js"></script>    
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const filterButtons = document.querySelectorAll('.filters a');
            const portfolioItems = document.querySelectorAll('.portfolio-item-wrapper');
            const paginationContainer = document.querySelector('.pagination-container .pagination');
            const itemsPerPage = 6; // Nombre de projets par page
            let currentPage = 1;

            // Fonction pour afficher les projets en fonction de la page et du filtre
            function displayProjects(filter = '*', page = 1) {
                const filteredItems = Array.from(portfolioItems).filter(item => {
                    return filter === '*' || item.classList.contains(filter.substring(1));
                });

                // Calcul des indices pour la pagination
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;

                // Affiche ou masque les projets
                portfolioItems.forEach(item => item.style.display = 'none'); // Masque tous les projets
                filteredItems.slice(startIndex, endIndex).forEach(item => item.style.display = 'block'); // Affiche les projets de la page

                // Met à jour la pagination
                updatePagination(filteredItems.length, page);
            }

            // Fonction pour mettre à jour la pagination
            function updatePagination(totalItems, activePage) {
                paginationContainer.innerHTML = ''; // Réinitialise la pagination
                const totalPages = Math.ceil(totalItems / itemsPerPage);

                for (let i = 1; i <= totalPages; i++) {
                    const li = document.createElement('li');
                    li.classList.add('page-item');
                    if (i === activePage) li.classList.add('active');

                    const a = document.createElement('a');
                    a.classList.add('page-link');
                    a.href = '#';
                    a.textContent = i;
                    a.setAttribute('data-page', i);

                    li.appendChild(a);
                    paginationContainer.appendChild(li);
                }

                // Ajoute les événements de clic sur les boutons de pagination
                const pageLinks = paginationContainer.querySelectorAll('.page-link');
                pageLinks.forEach(link => {
                    link.addEventListener('click', function (e) {
                        e.preventDefault();
                        currentPage = parseInt(this.getAttribute('data-page'));
                        const activeFilter = document.querySelector('.filters a.active').getAttribute('data-filter');
                        displayProjects(activeFilter, currentPage);
                    });
                });
            }

            // Ajoute les événements de clic sur les boutons de filtre
            filterButtons.forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault(); // Empêche le comportement par défaut du lien
                    const filter = this.getAttribute('data-filter');

                    // Supprime la classe active de tous les boutons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Ajoute la classe active au bouton cliqué
                    this.classList.add('active');

                    // Réinitialise la page actuelle et affiche les projets filtrés
                    currentPage = 1;
                    displayProjects(filter, currentPage);
                });
            });

            // Affiche les projets initiaux (tous les projets, page 1)
            displayProjects('*', 1);
        });
    </script>
{% endblock %}